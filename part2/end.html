<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-particle-system-component@1.0.9/dist/aframe-particle-system-component.min.js"></script>
    <!-- make an object turn to follow another object -->
    <script src="../resources/follow.js"></script>
    <!-- fire events when entering and exiting proximity of an object -->
    <script src="../resources/proximity.js"></script>
</head>
<body>

<a-scene>
    <a-plane position="0 0 -2" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
    <a-sky   color="black"></a-sky>
    <a-entity id='mycamera'
              camera="userHeight:1.6"
              look-controls wasd-controls></a-entity>
    <a-entity id='head'
              gltf-model="src:url(../resources/Bot_Head_Mesh.glb)"
              position="0 1 -2"
              follow="target:#mycamera"
              proximity="target:#mycamera; distance:2"
              visible="false"
    ></a-entity>
    <a-entity
            position="0 1 -2"
            particle-system="maxAge:1; velocityValue: 0 10 0; duration: 0;"
    ></a-entity>

</a-scene>

<script>
    const scene = AFRAME.scenes[0]

    scene.addEventListener('newAnchoredEntity', (e) => {
        const floor = e.detail
        const obj = document.querySelector('#head')
        obj.setAttribute('visible','true')
        scene.removeChild(obj)
        floor.appendChild(obj)
        scene.appendChild(floor)
        scene.removeAttribute('hit-test')
    });

    function stopParticles() {
        const particleEntity = document.querySelector('[particle-system]');
        particleEntity.components['particle-system'].particleGroup.emitters[0].disable();
    }
    function startParticles() {
        const particleEntity = document.querySelector('[particle-system]');
        particleEntity.components['particle-system'].particleGroup.emitters[0].enable();
    }

    const head = document.querySelector('#head');
    head.addEventListener('enter',()=> startParticles());
    head.addEventListener('exit',()=> stopParticles());
    document.querySelector('a-scene').addEventListener('loaded', () =>  stopParticles())

</script>
</body>
</html>